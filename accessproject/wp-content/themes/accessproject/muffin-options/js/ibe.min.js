window.ibe={settings:{version:.92,container:"ibe",debug:!1,region:"apac",region_subdomain:{emea:"app",apac:"app-apac"},domain:"thebookingbutton.com",property_customdomain:!1,templates:{property:"https://{region_subdomain}.{domain}/{clientid}properties/{channelcode}",property_customdomain:"https://{property_customdomain}/{clientid}properties/{channelcode}",widgets:{ga_proxy:"https://{region_subdomain}.{domain}/{clientid}/ga_proxy",ga_proxy_customdomain:"https://{property_customdomain}/{clientid}/ga_proxy",property_check_availability:"https://{region_subdomain}.{domain}/properties/{channelcode}/booking_widget",property_check_availability_customdomain:"https://{property_customdomain}/properties/{channelcode}/booking_widget",property_grid:"https://{region_subdomain}.{domain}/properties/{channelcode}/widget?number_of_days=14",property_grid_customdomain:"https://{property_customdomain}/properties/{channelcode}/widget?number_of_days=14"}},ga_active:!0==("undefined"!=typeof ga||"undefined"!=typeof dataLayer),ga_classname:"ibe_decorate",query:[],postmessage_domains:[],allowed_query_vars:["check_in_date","check_out_date","number_nights","number_adults","number_children","number_infants","promo_code","campaign","locale","currency","room_type","room_rate","rate_plan"]},getElements:function(e){if(document.getElementsByClassName)return document.getElementsByClassName(e);var t=[],i=document.getElementsByTagName("*");for(var a in i)if(i[a].className&&-1!==i[a].className.indexOf(e)){var n=i[a].className.split(" ");for(var s in n)if(n[s]==e){t.push(i[a]);break}}return t},getDataAttributes:function(e){for(var t={query:[]},i=e.attributes,a=i.length,n=0;n<a;n++)2===i.item(n).nodeType&&0===i.item(n).name.indexOf("data-")&&i.item(n).value.length&&(0===i.item(n).name.indexOf("data-query-")?t.query.push(i.item(n).name.substr(11).toLowerCase()+"="+escape(i.item(n).value)):t[i.item(n).name.substr(5).toLowerCase()]=i.item(n).value);return t},getUrlParameters:function(e){var t=document.location.href.split("?")[1];if(t&&t.length){var i=t.split("&");for(var a in i){var n=i[a].split("=");this.settings.allowed_query_vars.indexOf(n[0])>=0&&n[1].length&&e.push(i[a])}}return e},extend:function(e,t){var i={};for(var a in e)i[a]=e[a];for(var a in t)i[a]=t[a];return i},getLinker:function(e){return e?e.get("linkerParam"):ga.getAll()[0].get("linkerParam")},decorate:function(e){var t=ibe.getLinker(e),i=ibe.getElements(ibe.settings.ga_classname);for(var a in i){var n=i[a];if(n.getAttribute&&n.getAttribute("data-dst")){if("IFRAME"===n.tagName)n.setAttribute("src",ibe.getDecoratedURL(n,t));else if("FORM"===n.tagName){n.action=n.getAttribute("data-dst");var s=t.split("&");for(var a in s){var r=s[a].split("="),o=document.createElement("input");o.setAttribute("name",r[0]),o.setAttribute("value",r[1]),o.setAttribute("type","hidden"),o.name=r[0],o.value=r[1],o.type="hidden",n.appendChild(o)}}else n.setAttribute("href",ibe.getDecoratedURL(n,t));n.removeAttribute("data-dst")}}},getQuerySeparatorForUrl:function(e){return e.indexOf("?")>0?"&":"?"},getDecoratedURL:function(e,t){var i=e.getAttribute("data-dst");return i+ibe.getQuerySeparatorForUrl(i)+t},getPropertyUrl:function(e,t){var i;return e.channelcode||(ibe.debug("IBE: No Property Channelcode found!"),i="#error-no-channelcode-found"),i=!1!==t&&ibe.settings.templates.widgets[t]?!1!==e.property_customdomain?ibe.settings.templates.widgets[t+"_customdomain"].replace("{property_customdomain}",e.property_customdomain):ibe.settings.templates.widgets[t].replace("{region_subdomain}",e.region_subdomain[e.region]).replace("{domain}",e.domain):!1!==e.property_customdomain?ibe.settings.templates.property_customdomain.replace("{property_customdomain}",e.property_customdomain):ibe.settings.templates.property.replace("{region_subdomain}",e.region_subdomain[e.region]).replace("{domain}",e.domain),(i=i.replace("{channelcode}",escape(e.channelcode)).replace("{clientid}",ibe.formatClientId(e)))+(e.query.length>0?"?"+e.query.join("&"):"")},formatClientId:function(e){return e.clientid?escape(e.clientid)+"/":""},decorate_debug:function(e){var t=e?e.get("trackingId"):ga.getAll()[0].get("trackingId"),i=ibe.getElements(ibe.settings.ga_classname);ibe.debug("IBE: Decorating "+i.length+' Links, Forms or Frames with cross-domain tracking for Google Analytics Client ID "'+t+'"')},debug:function(e){ibe.settings.debug&&console.log(e)},backwardCompatibleWidgetGA:function(e){this.settings.ga_active&&!document.getElementById("ga_proxy_"+e.channelcode)&&(e.clientid?(ibe.debug('IBE: Creating Proxy Frame for cross-domain tracking for clientID "'+e.clientid+'"'),f=document.createElement("iframe"),f.style.display="none",f.style.width="1px",f.style.height="1px",f.style.overflow="hidden",f.setAttribute("data-dst",this.getPropertyUrl(this.extend(this.settings,e),"ga_proxy")),f.className+=" "+this.settings.ga_classname,f.id="ga_proxy_"+e.channelcode,document.body.appendChild(f)):ibe.debug("IBE: Cross-domain Tracking requires a clientID to be set up"))},go:function(){this.settings=this.extend(this.settings,this.getDataAttributes(document.body)),this.debug("IBE: Initiating IBE.JS Version "+this.settings.version);var e=this.getElements(this.settings.container),t=e.length;this.debug("IBE: Found "+t+' Elements with class name "'+this.settings.container+'":',e);for(o=0;o<t;o++)if("DIV"===e[o].tagName){var i=this.getDataAttributes(e[o]);if(i.query=this.getUrlParameters(i.query),"property_check_availability"==i.widget.toLowerCase()){this.debug("IBE: Creating Property check availability widget");(a=document.createElement("iframe")).style.border="none",a.style.width="250px",a.style.height="200px",a.style.overflow="hidden",a.setAttribute("src",this.getPropertyUrl(this.extend(this.settings,i),"property_check_availability")),e[o].append(a),this.backwardCompatibleWidgetGA(this.extend(this.settings,i))}else if("property_grid"==i.widget.toLowerCase()){this.debug("IBE: Creating Property Availability Grid widget");(a=document.createElement("iframe")).style.border="none",a.style.width="100%",a.style.minWidth="800px",a.style.height=(i.height||500)+"px",a.style.overflowX="hidden",a.setAttribute("src",this.getPropertyUrl(this.extend(this.settings,i),"property_grid")),e[o].append(a),this.backwardCompatibleWidgetGA(this.extend(this.settings,i))}else if("embed"==i.widget.toLowerCase()){var a=document.createElement("iframe");if(a.className=this.settings.container,a.style.border="none",a.style.width="100%",screen.width<768){this.debug("IBE: Creating embedded widget: Mobile Version");var n=document.createElement("meta");n.name="viewport",n.content="initial-scale=1, maximum-scale=1, minimum-scale=1",document.getElementsByTagName("head")[0].appendChild(n),a.style.width="100%",a.style.height="100%",a.style.position="absolute",a.style.left=0,a.style.right=0,a.style.top=0,a.style.zIndex=1e3,document.body.style.padding=0,document.body.style.margin=0,document.body.style.overflow="hidden"}else if(this.debug("IBE: Creating embedded widget: Desktop Version"),i.query.push("skin=0"),a.setAttribute("scrolling","no"),a.style.overflow="hidden",a.style.height="900px",a.style.minWidth="768px",a.style.maxWidth="995px",a.style.borderRadius="3px",window.postMessage){a.style.height="200px",a.style.overflow="hidden",a.className+=" "+this.settings.container+"fr";var s=document.createElement("a");s.href=this.getPropertyUrl(this.extend(this.settings,i),!1),this.settings.postmessage_domains.push(s.host),window.addEventListener("message",function(e){document.createElement("a");s.href=e.origin;for(var t in ibe.settings.postmessage_domains)if(0===ibe.settings.postmessage_domains[t].indexOf(s.host)&&parseInt(e.data)>100){for(var i=ibe.getElements(ibe.settings.container+"fr"),a=i.length,t=0;t<a;t++)i[t].style.height=parseInt(e.data)+30+"px";break}},!1)}if(a.setAttribute(this.settings.ga_active?"data-dst":"src",this.getPropertyUrl(this.extend(this.settings,i),!1)),this.settings.ga_active&&(a.className+=" "+this.settings.ga_classname),screen.width<768){for(var r=document.body.childNodes,t=r.length,o=0;o<t;o++)1==r[o].nodeType&&"SCRIPT"!==r[o].tagName&&(r[o].style.display="none");document.body.appendChild(a)}else e[o].append(a);break}}else e[o].setAttribute(this.settings.ga_active?"data-dst":"FORM"===e[o].tagName?"action":"href",this.getPropertyUrl(this.extend(this.settings,this.getDataAttributes(e[o])),!1)),this.settings.ga_active&&(e[o].className+=" "+this.settings.ga_classname);return this.settings.ga_active?"undefined"!=typeof ga?(ga(ibe.decorate),this.settings.debug&&(console.log("IBE: Google Analytics found"),ga(ibe.decorate_debug))):"undefined"!=typeof dataLayer&&(dataLayer.push(function(){"undefined"!=typeof ga&&ga(ibe.decorate)}),this.settings.debug&&(console.log("IBE: Google Tag Manager found"),dataLayer.push(function(){"undefined"!=typeof ga&&ga(ibe.decorate_debug)}))):this.debug("IBE: No Google Analytics or Tag Manager found: Ensure Analytics or GTM scripts are placed before ibe.js"),this}},ibe.go();